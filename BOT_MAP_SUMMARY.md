# üìä –ö–∞—Ä—Ç–∞ –±–æ—Ç–∞ "–¶–µ–Ω—Ç—Ä –±—É—Ö–≥–∞–ª—Ç–µ—Ä—Å–∫–æ–≥–æ —É—á–µ—Ç–∞" - –ò—Ç–æ–≥–æ–≤—ã–π –æ—Ç—á–µ—Ç

## ‚úÖ –í–´–ü–û–õ–ù–ï–ù–û

### 1. –ê–Ω–∞–ª–∏–∑ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–≤
**–í—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –º–µ—Ç–æ–¥—ã –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∫–∞—Ä—Ç—ã –±–æ—Ç–∞ –î–û–°–¢–£–ü–ù–´:**

- ‚úÖ `sendMessage` - –¥–ª—è —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
- ‚úÖ `inlineKeyboard` - –¥–ª—è –º–µ–Ω—é —Å –∫–Ω–æ–ø–∫–∞–º–∏ (–≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é, –ø–æ–¥–º–µ–Ω—é, –≤—ã–±–æ—Ä –æ–ø—Ü–∏–π)
- ‚úÖ `question` - –¥–ª—è –≤–æ–ø—Ä–æ—Å–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é (–§–ò–û, —Ç–µ–ª–µ—Ñ–æ–Ω, –ò–ù–ù –∏ —Ç.–¥.)
- ‚úÖ `sendDocument` - –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø—Ä–∞–π—Å–æ–≤
- ‚úÖ `managerChat` - –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –Ω–∞ –º–µ–Ω–µ–¥–∂–µ—Ä–∞
- ‚úÖ `replyKeyboard` - –¥–ª—è reply-–∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã (–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ inline)

**–í—ã–≤–æ–¥:** ‚úÖ **–í–°–ï –ú–ï–¢–û–î–´ –ò–ú–ï–Æ–¢–°–Ø –î–õ–Ø –†–ï–ê–õ–ò–ó–ê–¶–ò–ò!**

---

### 2. –°–æ–∑–¥–∞–Ω–∞ –±–∞–∑–æ–≤–∞—è –∫–∞—Ä—Ç–∞ –±–ª–æ–∫–æ–≤

**–§–∞–π–ª:** `bot_map_full.json`

**–°–æ–¥–µ—Ä–∂–∏—Ç:**
- –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ (–±–ª–æ–∫ 1)
- –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é —Å 7 –ø—É–Ω–∫—Ç–∞–º–∏ (–±–ª–æ–∫ 2)
- –ü—Ä–∏–º–µ—Ä –ø–µ—Ä–≤–æ–π –≤–µ—Ç–∫–∏ "–°–æ–∑–¥–∞—Ç—å/–∏–∑–º–µ–Ω–∏—Ç—å/–∑–∞–∫—Ä—ã—Ç—å –±–∏–∑–Ω–µ—Å" (–±–ª–æ–∫–∏ 3-11)
- –§–∏–Ω–∞–ª—å–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è (–±–ª–æ–∫–∏ 16-20)
- –í–µ—Ç–∫–∞ "–°–≤—è–∑–∞—Ç—å—Å—è —Å –º–µ–Ω–µ–¥–∂–µ—Ä–æ–º" (–±–ª–æ–∫–∏ 21-24)

**–í—Å–µ–≥–æ –±–ª–æ–∫–æ–≤ –≤ –±–∞–∑–æ–≤–æ–π –∫–∞—Ä—Ç–µ:** 24

---

## üìã –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–ª–æ–∫–æ–≤

### –§–æ—Ä–º–∞—Ç –±–ª–æ–∫–∞:
```json
{
  "id": "—É–Ω–∏–∫–∞–ª—å–Ω—ã–π_id",
  "type": "block",
  "method": "sendMessage|inlineKeyboard|question|sendDocument|managerChat",
  "method_data": {
    // –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –º–µ—Ç–æ–¥–∞
  },
  "x": –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞_x,
  "y": –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞_y,
  "nextBlockId": "id_—Å–ª–µ–¥—É—é—â–µ–≥–æ_–±–ª–æ–∫–∞",
  "label": "–ü–æ–¥–ø–∏—Å—å –±–ª–æ–∫–∞"
}
```

### –¢–∏–ø—ã –±–ª–æ–∫–æ–≤ –≤ –∫–∞—Ä—Ç–µ:

1. **sendMessage** - –¢–µ–∫—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
   - –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ
   - –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
   - –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è

2. **inlineKeyboard** - –ú–µ–Ω—é —Å –∫–Ω–æ–ø–∫–∞–º–∏
   - –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é (7 –ø—É–Ω–∫—Ç–æ–≤)
   - –ü–æ–¥–º–µ–Ω—é —É—Å–ª—É–≥
   - –í—ã–±–æ—Ä –æ–ø—Ü–∏–π (–û–ü–§, —Ç–∏–ø –∏–∑–º–µ–Ω–µ–Ω–∏–π –∏ —Ç.–¥.)
   - –§–∏–Ω–∞–ª—å–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è

3. **question** - –í–æ–ø—Ä–æ—Å—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
   - –§–ò–û
   - –¢–µ–ª–µ—Ñ–æ–Ω
   - –ò–ù–ù

4. **sendDocument** - –û—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–∞–π–ª–æ–≤
   - –ü—Ä–∞–π—Å-–ª–∏—Å—Ç

5. **managerChat** - –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ –º–µ–Ω–µ–¥–∂–µ—Ä–∞

---

## üîÑ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∫–∞—Ä—Ç—ã

### –û–±—â–∏–π –ø–∞—Ç—Ç–µ—Ä–Ω –≤–µ—Ç–∫–∏:

```
–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
    ‚Üì
"–û—Ç–ª–∏—á–Ω–æ! –í—ã–±–µ—Ä–µ—Ç–µ –Ω—É–∂–Ω—ã–π –∑–∞–ø—Ä–æ—Å."
    ‚Üì
–ü–æ–¥–º–µ–Ω—é –≤—ã–±–æ—Ä–∞ —É—Å–ª—É–≥–∏
    ‚Üì
"–û—Ç–≤–µ—Ç—å—Ç–µ –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–æ–ø—Ä–æ—Å–æ–≤..."
    ‚Üì
–°–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö:
  - –§–ò–û (question)
  - –¢–µ–ª–µ—Ñ–æ–Ω (question)
  - –ò–ù–ù (question)
  - –û–ü–§ (inlineKeyboard)
    ‚Üì
–°–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã (–∑–∞–≤–∏—Å—è—Ç –æ—Ç –≤–µ—Ç–∫–∏)
    ‚Üì
–û–ø–∏—Å–∞–Ω–∏–µ —Å–∏—Ç—É–∞—Ü–∏–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
    ‚Üì
–°–æ–≥–ª–∞—Å–∏–µ —Å –ø–æ–ª–∏—Ç–∏–∫–æ–π
    ‚Üì
"–û—Ç–ª–∏—á–Ω–æ! –í—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è —Å–æ–±—Ä–∞–Ω–∞."
    ‚Üì
–§–∏–Ω–∞–ª—å–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è:
  - –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É
  - –û–∑–Ω–∞–∫–æ–º–∏—Ç—å—Å—è —Å –ø—Ä–∞–π—Å–æ–º
  - –°–≤—è–∑–∞—Ç—å—Å—è —Å –º–µ–Ω–µ–¥–∂–µ—Ä–æ–º
  - –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
```

---

## ‚ö†Ô∏è –û–ì–†–ê–ù–ò–ß–ï–ù–ò–Ø –¢–ï–ö–£–©–ï–ô –†–ï–ê–õ–ò–ó–ê–¶–ò–ò

### –ß—Ç–æ –ù–ï —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –¥–ª—è –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–π —Ä–∞–±–æ—Ç—ã –±–æ—Ç–∞:

1. **Webhook Handler** ‚ùå
   - –ù–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ `callback_query` –æ—Ç inline-–∫–Ω–æ–ø–æ–∫
   - –ù–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   - **–¢—Ä–µ–±—É–µ—Ç—Å—è:** –°–æ–∑–¥–∞—Ç—å endpoint –¥–ª—è webhook –æ—Ç Telegram

2. **State Management** ‚ùå
   - –ù–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –¥–∏–∞–ª–æ–≥–∞
   - –ù–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç—Å—è, –Ω–∞ –∫–∞–∫–æ–º —ç—Ç–∞–ø–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
   - **–¢—Ä–µ–±—É–µ—Ç—Å—è:** –•—Ä–∞–Ω–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤ Redis/–ë–î

3. **Conditional Routing** ‚ùå
   - –ë–ª–æ–∫–∏ —Å–≤—è–∑–∞–Ω—ã —á–µ—Ä–µ–∑ `nextBlockId`, –Ω–æ –Ω–µ—Ç –ª–æ–≥–∏–∫–∏ –≤—ã–±–æ—Ä–∞ —Å–ª–µ–¥—É—é—â–µ–≥–æ –±–ª–æ–∫–∞ –ø–æ callback_data
   - **–¢—Ä–µ–±—É–µ—Ç—Å—è:** –†–æ—É—Ç–∏–Ω–≥ –Ω–∞ –æ—Å–Ω–æ–≤–µ callback_data –∫–Ω–æ–ø–æ–∫

4. **Validation** ‚ùå
   - –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ñ–æ—Ä–º–∞—Ç–∞ –¥–∞–Ω–Ω—ã—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ò–ù–ù - —Ç–æ–ª—å–∫–æ —á–∏—Å–ª–∞)
   - **–¢—Ä–µ–±—É–µ—Ç—Å—è:** –î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –¥–ª—è –ø–æ–ª–µ–π

5. **Variables** ‚ùå
   - –ù–µ—Ç –ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∏ –∏–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ —Å–æ–æ–±—â–µ–Ω–∏—è
   - **–¢—Ä–µ–±—É–µ—Ç—Å—è:** –ü–∞—Ä—Å–∏–Ω–≥ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –≤ —Ç–µ–∫—Å—Ç–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `{–∏–º—è}`)

---

## üöÄ –ü–õ–ê–ù –†–ï–ê–õ–ò–ó–ê–¶–ò–ò –ü–û–õ–ù–û–ô –ö–ê–†–¢–´

### –≠—Ç–∞–ø 1: –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –∫–∞—Ä—Ç—ã –±–ª–æ–∫–æ–≤
- [ ] –î–æ–±–∞–≤–∏—Ç—å –≤—Å–µ 7 –≤–µ—Ç–æ–∫ –ø–æ–ª–Ω–æ—Å—Ç—å—é
- [ ] –î–æ–±–∞–≤–∏—Ç—å –≤—Å–µ –ø–æ–¥–≤–µ—Ç–∫–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 5 –ø–æ–¥–≤–µ—Ç–æ–∫ –¥–ª—è –≤–µ—Ç–∫–∏ 1)
- [ ] –î–æ–±–∞–≤–∏—Ç—å —É—Å–ª–æ–≤–Ω—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã

### –≠—Ç–∞–ø 2: Webhook Handler
- [ ] –°–æ–∑–¥–∞—Ç—å endpoint `/api/telegram/webhook/{bot_id}`
- [ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ `callback_query`
- [ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ `message` (—Ç–µ–∫—Å—Ç–æ–≤—ã–µ –æ—Ç–≤–µ—Ç—ã)
- [ ] –†–æ—É—Ç–∏–Ω–≥ –Ω–∞ –æ—Å–Ω–æ–≤–µ callback_data ‚Üí –±–ª–æ–∫

### –≠—Ç–∞–ø 3: State Management
- [ ] –•—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –¥–∏–∞–ª–æ–≥–∞ (—Ç–µ–∫—É—â–∏–π –±–ª–æ–∫, —Å–æ–±—Ä–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ)
- [ ] –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø—Ä–∏ –æ—Ç–≤–µ—Ç–∞—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- [ ] –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø—Ä–∏ –≤–æ–∑–≤—Ä–∞—Ç–µ

### –≠—Ç–∞–ø 4: Validation & Variables
- [ ] –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ–ª–µ–π (–ò–ù–ù, —Ç–µ–ª–µ—Ñ–æ–Ω)
- [ ] –ü–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –≤ —Ç–µ–∫—Å—Ç–µ

---

## üìù –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–ï –ö–ê–†–¢–´

### –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–æ–∑–¥–∞–Ω–Ω—É—é –∫–∞—Ä—Ç—É:

1. **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –±–æ—Ç:**
   ```php
   $bot = Bot::find($botId);
   $bot->update([
       'blocks' => json_decode(file_get_contents('bot_map_full.json'), true)['blocks']
   ]);
   ```

2. **–ü—Ä–æ—Å–º–æ—Ç—Ä –≤ –∞–¥–º–∏–Ω–∫–µ:**
   - –û—Ç–∫—Ä–æ–π—Ç–µ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å ‚Üí Bots
   - –í—ã–±–µ—Ä–∏—Ç–µ –±–æ—Ç–∞
   - –ë–ª–æ–∫–∏ –æ—Ç–æ–±—Ä–∞–∑—è—Ç—Å—è –≤ –¥–∏–∞–≥—Ä–∞–º–º–µ

3. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–ª–æ–∫–æ–≤:**
   - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ API endpoint `/api/bots/{id}/execute-block-method`
   - –ü–µ—Ä–µ–¥–∞–π—Ç–µ `method`, `method_data`, `chat_id`

---

## üìä –°–¢–ê–¢–ò–°–¢–ò–ö–ê

- **–ë–ª–æ–∫–æ–≤ –≤ –±–∞–∑–æ–≤–æ–π –∫–∞—Ä—Ç–µ:** 24
- **–û—Ü–µ–Ω–∫–∞ –¥–ª—è –ø–æ–ª–Ω–æ–π –∫–∞—Ä—Ç—ã:** 100-150 –±–ª–æ–∫–æ–≤
- **–í–µ—Ç–æ–∫:** 7 –æ—Å–Ω–æ–≤–Ω—ã—Ö
- **–ü–æ–¥–≤–µ—Ç–æ–∫:** ~20-30
- **–£—Ä–æ–≤–Ω–µ–π –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç–∏:** –¥–æ 5

---

## ‚úÖ –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï

**–ö–∞—Ä—Ç–∞ –±–æ—Ç–∞ —Å–æ–∑–¥–∞–Ω–∞ –∏ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!**

‚úÖ –í—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –º–µ—Ç–æ–¥—ã –¥–æ—Å—Ç—É–ø–Ω—ã  
‚úÖ –ë–∞–∑–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–ª–æ–∫–æ–≤ —Å–æ–∑–¥–∞–Ω–∞  
‚úÖ –§–æ—Ä–º–∞—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è  
‚ö†Ô∏è –î–ª—è –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Ç—Ä–µ–±—É–µ—Ç—Å—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è webhook handler –∏ state management

**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:** –†–µ–∞–ª–∏–∑–∞—Ü–∏—è webhook handler –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –±–æ—Ç–æ–º.

