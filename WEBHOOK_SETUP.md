# Настройка Webhook для ботов

## Что было реализовано

✅ **Обработчик webhook** - `/api/telegram/webhook/{bot_id}`
✅ **Логирование всех действий** - все операции логируются в Laravel Log
✅ **Сохранение сессий** - полная история взаимодействий пользователей
✅ **Сохранение файлов** - все документы, фото, видео сохраняются
✅ **Сохранение ответов** - все ответы пользователей записываются
✅ **Статистика** - API для получения статистики
✅ **Интерфейс просмотра** - страница для просмотра прохождений

## Настройка Webhook в Telegram

Для работы бота нужно установить webhook:

```bash
curl -X POST "https://api.telegram.org/bot<BOT_TOKEN>/setWebhook" \
  -d "url=https://ваш-домен.ru/api/telegram/webhook/1"
```

Где:
- `<BOT_TOKEN>` - токен вашего бота
- `1` - ID бота в системе

## Структура логирования

Все операции логируются с разными уровнями:

- **INFO** - обычные операции (создание сессии, обработка сообщений)
- **WARNING** - предупреждения (бот не активен, блоки не найдены)
- **ERROR** - ошибки (исключения, проблемы с выполнением блоков)
- **DEBUG** - отладочная информация (детали обработки)

## Логи можно найти в:

- `storage/logs/laravel.log` - основной файл логов
- Используйте команду: `tail -f storage/logs/laravel.log` для мониторинга в реальном времени

## Примеры запросов к API

### Получить список сессий:
```
GET /api/v1/bot-sessions?bot_id=1&status=active
```

### Получить детали сессии:
```
GET /api/v1/bot-sessions/{session_id}
```

### Получить статистику:
```
GET /api/v1/bot-sessions/statistics?bot_id=1
```

## Что логируется

1. **Входящие обновления от Telegram**
   - Тип обновления
   - Chat ID
   - Содержимое сообщения

2. **Обработка сессий**
   - Создание новой сессии
   - Обновление существующей сессии
   - Переход между блоками

3. **Выполнение блоков**
   - Какой блок выполняется
   - Метод блока
   - Результат выполнения

4. **Сохранение данных**
   - Собранные данные пользователя
   - Загруженные файлы
   - Ответы пользователя

5. **Ошибки**
   - Все исключения
   - Проблемы с выполнением блоков
   - Ошибки сохранения данных

